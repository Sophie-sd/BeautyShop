{% extends 'base.html' %}
{% load static %}

{% block title %}–ö–æ—à–∏–∫ - Beauty Shop{% endblock %}

{% block body_class %}cart-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cart.css' %}">
{% endblock %}

{% block content %}
<section class="cart-section section-padding">
    <div class="container">
        {% if cart %}
            <div class="cart-content">
                <div class="cart-items">
                    {% for item in cart %}
                        <div class="cart-item" data-product-id="{{ item.product.id }}" data-price="{{ item.price }}">
                            <button class="cart-item__remove" 
                                    data-product-id="{{ item.product.id }}"
                                    data-product-name="{{ item.product.name }}"
                                    aria-label="–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä">
                                &times;
                            </button>
                            
                            <div class="cart-item__image">
                                {% if item.product.images.first %}
                                    <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.name }}">
                                {% else %}
                                    <div class="product-placeholder">
                                        <i class="icon-product">üì¶</i>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="cart-item__info">
                                <h3 class="cart-item__name">{{ item.product.name }}</h3>
                            </div>
                            
                            <div class="cart-item__controls">
                                <div class="cart-item__quantity">
                                    <button class="quantity-btn quantity-btn--minus" 
                                            data-product-id="{{ item.product.id }}"
                                            data-action="decrease"
                                            aria-label="–ó–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å">
                                        &minus;
                                    </button>
                                    <span class="quantity-value" data-product-id="{{ item.product.id }}">{{ item.quantity }}</span>
                                    <button class="quantity-btn quantity-btn--plus" 
                                            data-product-id="{{ item.product.id }}"
                                            data-action="increase"
                                            aria-label="–ó–±—ñ–ª—å—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å">
                                        &#43;
                                    </button>
                                </div>
                                
                                <div class="cart-item__price">
                                    {% if item.product.is_sale_active %}
                                        {% if user.is_authenticated and user.is_wholesale and not user.is_staff and not user.is_superuser %}
                                            {% if item.product.wholesale_price %}
                                                <span class="cart-item__price-old">{{ item.product.wholesale_price }} ‚Ç¥</span>
                                            {% else %}
                                                <span class="cart-item__price-old">{{ item.product.retail_price }} ‚Ç¥</span>
                                            {% endif %}
                                        {% else %}
                                            {% if item.quantity >= 5 and item.product.price_5_qty %}
                                                <span class="cart-item__price-old">{{ item.product.price_5_qty }} ‚Ç¥</span>
                                            {% elif item.quantity >= 3 and item.product.price_3_qty %}
                                                <span class="cart-item__price-old">{{ item.product.price_3_qty }} ‚Ç¥</span>
                                            {% else %}
                                                <span class="cart-item__price-old">{{ item.product.retail_price }} ‚Ç¥</span>
                                            {% endif %}
                                        {% endif %}
                                        <span class="cart-item__price-current">{{ item.total_price }} ‚Ç¥</span>
                                    {% else %}
                                        <span class="cart-item__price-current">{{ item.total_price }} ‚Ç¥</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="cart-summary">
                    <div class="promo-code-section">
                        <h3>–ü—Ä–æ–º–æ–∫–æ–¥</h3>
                        <div class="promo-code-input-group">
                            <input type="text" 
                                   id="promo-code" 
                                   class="form-control" 
                                   placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥"
                                   value="{{ request.session.promo_code|default:'' }}">
                            <button class="btn btn-outline apply-promo-btn">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
                        </div>
                        <div class="promo-message" style="display:none;"></div>
                    </div>
                    
                    <div class="summary-details">
                        <div class="summary-row">
                            <span>–°—É–º–∞ —Ç–æ–≤–∞—Ä—ñ–≤:</span>
                            <span class="cart-subtotal">{{ cart.get_original_total_price }} ‚Ç¥</span>
                        </div>
                        
                        {% if cart.get_savings_amount > 0 %}
                        <div class="summary-row summary-savings">
                            <span>–°—É–º–∞ –µ–∫–æ–Ω–æ–º—ñ—ó:</span>
                            <span class="cart-savings">-{{ cart.get_savings_amount }} ‚Ç¥</span>
                        </div>
                        {% endif %}
                        
                        {% if request.session.promo_discount %}
                        <div class="summary-row summary-promo">
                            <span>–ü—Ä–æ–º–æ–∫–æ–¥ ({{ request.session.promo_code }}):</span>
                            <span class="promo-discount">{{ request.session.promo_discount }} ‚Ç¥</span>
                        </div>
                        {% endif %}
                        
                        <div class="summary-row summary-total">
                            <span>–î–æ —Å–ø–ª–∞—Ç–∏:</span>
                            <span class="cart-grand-total">
                                {% if request.session.promo_discount %}
                                    {{ cart.get_total_price|add:request.session.promo_discount|floatformat:2 }} ‚Ç¥
                                {% else %}
                                    {{ cart.get_total_price }} ‚Ç¥
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    
                    {% if user.is_authenticated %}
                        {% if cart.get_total_price < 5000 %}
                            <div class="cart-warning">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                    <line x1="12" y1="9" x2="12" y2="13"></line>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                <div>
                                    <strong>–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –æ–ø—Ç–æ–≤–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ ‚Äî 5000 –≥—Ä–Ω.</strong>
                                    <p>–ü–æ—Ç–æ—á–Ω–∞ —Å—É–º–∞: {{ cart.get_total_price }} ‚Ç¥. –ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–¥–∞–π—Ç–µ —â–µ —Ç–æ–≤–∞—Ä—ñ–≤ –∞–±–æ <a href="{% url 'users:logout' %}">–≤–∏–π–¥—ñ—Ç—å –∑ –∫–∞–±—ñ–Ω–µ—Ç—É</a> –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å.</p>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                    
                    <div class="cart-actions">
                        <a href="{% url 'core:catalog' %}" class="btn btn-outline">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –ø–æ–∫—É–ø–∫–∏</a>
                        {% if user.is_authenticated and user.is_wholesale and not user.is_staff and not user.is_superuser %}
                            {% if cart.get_total_price < 5000 %}
                                <button type="button" class="btn btn-primary btn-disabled" disabled title="–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è 5000 –≥—Ä–Ω">–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
                            {% else %}
                                <a href="{% url 'orders:create' %}" class="btn btn-primary">–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'orders:create' %}" class="btn btn-primary">–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% else %}
            <div class="empty-cart text-center">
                <div class="empty-cart-icon">
                    <i class="icon-cart">üõí</i>
                </div>
                <h2>–í–∞—à –∫–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</h2>
                <p>–î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∫–æ—à–∏–∫–∞, —â–æ–± –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –ø–æ–∫—É–ø–∫–∏</p>
                <a href="{% url 'core:catalog' %}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</a>
            </div>
        {% endif %}
    </div>
</section>

{% endblock %}

