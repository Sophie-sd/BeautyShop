{% load static %}
<article class="product-card{% if card_class %} {{ card_class }}{% endif %}" 
         data-product-id="{{ product.id }}"
         {% if product.retail_price %}data-price="{{ product.retail_price }}"{% endif %}
         {% if product.sale_price %}data-sale-price="{{ product.sale_price }}"{% endif %}
         {% if product.is_in_stock %}data-in-stock="true"{% else %}data-in-stock="false"{% endif %}
         {% if product.is_sale_active %}data-is-sale="true"{% endif %}
         {% if product.is_new %}data-is-new="true"{% endif %}
         data-name="{{ product.name }}">
    
    <div class="product-card__media">
        <a href="{{ product.get_absolute_url }}" class="product-card__image-link">
            {% if product.images.first %}
                <img 
                    src="{{ product.images.first.image.url }}" 
                    alt="{{ product.name }}" 
                    class="product-card__image"
                    loading="lazy"
                    width="300"
                    height="300"
                >
            {% elif product.main_image %}
                <img 
                    src="{{ product.main_image.image.url }}" 
                    alt="{{ product.name }}" 
                    class="product-card__image"
                    loading="lazy"
                    width="300"
                    height="300"
                >
            {% else %}
                <div class="product-card__placeholder">
                    üì¶
                </div>
            {% endif %}
        </a>
        
        <button 
            type="button"
            class="product-card__wishlist{% if in_wishlist %} product-card__wishlist--active{% endif %}" 
            data-product-id="{{ product.id }}" 
            aria-label="{% if in_wishlist %}–í–∏–¥–∞–ª–∏—Ç–∏ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ{% else %}–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ{% endif %}"
            title="{% if in_wishlist %}–í–∏–¥–∞–ª–∏—Ç–∏ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ{% else %}–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ{% endif %}"
        >
            <span class="product-card__wishlist-icon">{% if in_wishlist %}‚ô•{% else %}‚ô°{% endif %}</span>
        </button>
        
        {% if product.get_stickers %}
            <div class="product-card__badges">
                {% for sticker in product.get_stickers %}
                    <span class="product-badge product-badge--{{ sticker.type }}">
                        {{ sticker.text }}
                    </span>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    
    <div class="product-card__content">
        <h3 class="product-card__name">
            <a href="{{ product.get_absolute_url }}" class="product-card__link">
                {{ product.name }}
            </a>
        </h3>
        
        <div class="product-card__price">
            {% if user.is_authenticated and user.is_wholesale and not user.is_staff and not user.is_superuser %}
                <!-- –î–ª—è –æ–ø—Ç–æ–≤–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤: –æ–ø—Ç–æ–≤–∞ (–∞–±–æ –∞–∫—Ü—ñ–π–Ω–∞) + –ø–µ—Ä–µ–∫—Ä–µ—Å–ª–µ–Ω–∞ —Ä–æ–∑–¥—Ä—ñ–±–Ω–∞ -->
                <div class="product-card__price-row">
                    {% if product.wholesale_price %}
                        {% if product.is_sale_active and product.sale_price and product.sale_price < product.wholesale_price %}
                            <span class="product-card__price-current">{{ product.sale_price }} ‚Ç¥</span>
                            <span class="product-card__price-old">{{ product.wholesale_price }} ‚Ç¥</span>
                        {% else %}
                            <span class="product-card__price-current">{{ product.wholesale_price }} ‚Ç¥</span>
                            <span class="product-card__price-old">{{ product.retail_price }} ‚Ç¥</span>
                        {% endif %}
                    {% else %}
                        <span class="product-card__price-current">{{ product.retail_price }} ‚Ç¥</span>
                    {% endif %}
                </div>
            {% else %}
                <!-- –î–ª—è –Ω–µ–∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏—Ö —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤: —Ä–æ–∑–¥—Ä—ñ–±–Ω–∞ (–∞–±–æ –∞–∫—Ü—ñ–π–Ω–∞) + —ñ–Ω—Ñ–æ –ø—Ä–æ –≥—Ä–∞–¥–∞—Ü—ñ—é -->
                <div class="product-card__price-row">
                    {% if product.is_sale_active and product.sale_price %}
                        <span class="product-card__price-current">{{ product.sale_price }} ‚Ç¥</span>
                        <span class="product-card__price-old">{{ product.retail_price }} ‚Ç¥</span>
                    {% else %}
                        <span class="product-card__price-current">{{ product.retail_price }} ‚Ç¥</span>
                    {% endif %}
                </div>
                {% if product.price_3_qty or product.price_5_qty %}
                    <div class="product-card__price-row product-card__price-row--tiers">
                        <span class="product-card__price-tiers">–≤—ñ–¥ {{ product.price_5_qty|default:product.price_3_qty }} ‚Ç¥</span>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        
        <button 
            type="button"
            class="product-card__add-cart" 
            data-product-id="{{ product.id }}"
            data-product-name="{{ product.name }}"
            {% if not product.is_in_stock %}disabled{% endif %}
        >
            {% if product.is_in_stock %}
                –î–æ –∫–æ—à–∏–∫–∞
            {% else %}
                –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
            {% endif %}
        </button>
    </div>
</article>
