// Custom Admin JavaScript Ð´Ð»Ñ Beauty Shop
// ÐŸÐ¾ÐºÑ€Ð°Ñ‰ÑƒÑ” UX, Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·ÑƒÑ” Ñ€ÑƒÑ‚Ð¸Ð½Ð½Ñ– Ð¾Ð¿ÐµÑ€Ð°Ñ†Ñ–Ñ—

(function() {
    'use strict';
    
    // ============================================
    // UTILITY Ð¤Ð£ÐÐšÐ¦Ð†Ð‡
    // ============================================
    
    const BeautyShopAdmin = {
        // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ
        showMessage(text, type = 'success') {
            const message = document.createElement('div');
            message.className = `admin-flash-message admin-flash-${type}`;
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#48bb78' : '#f56565'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 99999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            message.textContent = text;
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transform = 'translateX(100%)';
                setTimeout(() => document.body.removeChild(message), 300);
            }, 3000);
        },
        
        // ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð² Ð±ÑƒÑ„ÐµÑ€
        copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    this.showMessage('Ð¡ÐºÐ¾Ð¿Ñ–Ð¹Ð¾Ð²Ð°Ð½Ð¾ Ð² Ð±ÑƒÑ„ÐµÑ€ Ð¾Ð±Ð¼Ñ–Ð½Ñƒ!');
                });
            } else {
                // Fallback Ð´Ð»Ñ ÑÑ‚Ð°Ñ€Ð¸Ñ… Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ–Ð²
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                this.showMessage('Ð¡ÐºÐ¾Ð¿Ñ–Ð¹Ð¾Ð²Ð°Ð½Ð¾ Ð² Ð±ÑƒÑ„ÐµÑ€ Ð¾Ð±Ð¼Ñ–Ð½Ñƒ!');
            }
        },
        
        // ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð½Ñ Ð´Ñ–Ñ—
        confirm(message, callback) {
            if (window.confirm(message)) {
                callback();
            }
        }
    };
    
    // Ð•ÐºÑÐ¿Ð¾Ñ€Ñ‚ÑƒÑ”Ð¼Ð¾ Ð² Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñƒ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
    window.BeautyShopAdmin = BeautyShopAdmin;
    
    // ============================================
    // DOCUMENT READY
    // ============================================
    
    document.addEventListener('DOMContentLoaded', function() {
        
        // ========== Ð¤ÐžÐ ÐœÐ˜ ==========
        
        // ÐŸÐ¾ÐºÑ€Ð°Ñ‰ÑƒÑ”Ð¼Ð¾ UX Ð¿Ñ€Ð¸ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ñ†Ñ– Ñ„Ð¾Ñ€Ð¼
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const submitBtn = form.querySelector('input[type="submit"]');
                if (submitBtn && !submitBtn.dataset.submitting) {
                    submitBtn.dataset.submitting = 'true';
                    submitBtn.disabled = true;
                    const originalValue = submitBtn.value;
                    submitBtn.value = 'Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ...';
                    
                    // Ð¯ÐºÑ‰Ð¾ Ñ„Ð¾Ñ€Ð¼Ð° Ð½Ðµ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒÑÑ Ð·Ð° 10 ÑÐµÐºÑƒÐ½Ð´, Ð¿Ð¾Ð²ÐµÑ€Ñ‚Ð°Ñ”Ð¼Ð¾ ÐºÐ½Ð¾Ð¿ÐºÑƒ
                    setTimeout(() => {
                        submitBtn.disabled = false;
                        submitBtn.value = originalValue;
                        delete submitBtn.dataset.submitting;
                    }, 10000);
                }
            });
        });
        
        // ========== SLUG ÐÐ’Ð¢ÐžÐ—ÐÐŸÐžÐ’ÐÐ•ÐÐÐ¯ ==========
        
        const titleField = document.querySelector('#id_title, #id_name');
        const slugField = document.querySelector('#id_slug');
        
        if (titleField && slugField) {
            titleField.addEventListener('input', function() {
                // Ð“ÐµÐ½ÐµÑ€ÑƒÑ”Ð¼Ð¾ slug Ñ‚Ñ–Ð»ÑŒÐºÐ¸ ÑÐºÑ‰Ð¾ Ð¿Ð¾Ð»Ðµ Ð¿Ð¾Ñ€Ð¾Ð¶Ð½Ñ”
                if (!slugField.value || slugField.dataset.autoGenerated) {
                    let slug = this.value
                        .toLowerCase()
                        .replace(/[^a-z0-9Ð°-ÑÑ”Ñ–Ñ—\s-]/g, '')
                        .replace(/\s+/g, '-')
                        .replace(/-+/g, '-')
                        .trim();
                    
                    // Ð¢Ñ€Ð°Ð½ÑÐ»Ñ–Ñ‚ÐµÑ€Ð°Ñ†Ñ–Ñ ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ¸Ñ… ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ–Ð²
                    const ukrainianToLatin = {
                        'Ð°': 'a', 'Ð±': 'b', 'Ð²': 'v', 'Ð³': 'h', 'Ò‘': 'g',
                        'Ð´': 'd', 'Ðµ': 'e', 'Ñ”': 'ye', 'Ð¶': 'zh', 'Ð·': 'z',
                        'Ð¸': 'y', 'Ñ–': 'i', 'Ñ—': 'yi', 'Ð¹': 'y', 'Ðº': 'k',
                        'Ð»': 'l', 'Ð¼': 'm', 'Ð½': 'n', 'Ð¾': 'o', 'Ð¿': 'p',
                        'Ñ€': 'r', 'Ñ': 's', 'Ñ‚': 't', 'Ñƒ': 'u', 'Ñ„': 'f',
                        'Ñ…': 'kh', 'Ñ†': 'ts', 'Ñ‡': 'ch', 'Ñˆ': 'sh', 'Ñ‰': 'shch',
                        'ÑŽ': 'yu', 'Ñ': 'ya', 'ÑŒ': '', 'ÑŠ': ''
                    };
                    
                    for (let [uk, lat] of Object.entries(ukrainianToLatin)) {
                        slug = slug.replace(new RegExp(uk, 'g'), lat);
                    }
                    
                    slugField.value = slug.substring(0, 50);
                    slugField.dataset.autoGenerated = 'true';
                }
            });
            
            // Ð¯ÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð²Ñ€ÑƒÑ‡Ð½Ñƒ Ñ€ÐµÐ´Ð°Ð³ÑƒÑ” slug, Ð²Ð¸Ð¼Ð¸ÐºÐ°Ñ”Ð¼Ð¾ Ð°Ð²Ñ‚Ð¾Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–ÑŽ
            slugField.addEventListener('input', function() {
                if (this.value !== '') {
                    delete this.dataset.autoGenerated;
                }
            });
        }
        
        // ========== ÐŸÐ Ð•Ð’Ð¬Ð® Ð—ÐžÐ‘Ð ÐÐ–Ð•ÐÐ¬ ==========
        
        const imageInputs = document.querySelectorAll('input[type="file"][accept*="image"]');
        imageInputs.forEach(input => {
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑ”Ð¼Ð¾ Ð°Ð±Ð¾ Ð¾Ð½Ð¾Ð²Ð»ÑŽÑ”Ð¼Ð¾ Ð¿Ñ€ÐµÐ²ÑŒÑŽ
                        let preview = input.parentElement.querySelector('.image-preview');
                        if (!preview) {
                            preview = document.createElement('div');
                            preview.className = 'image-preview';
                            preview.style.cssText = `
                                margin-top: 15px;
                                border: 2px dashed #e2e8f0;
                                border-radius: 8px;
                                padding: 15px;
                                text-align: center;
                                background: #f7fafc;
                            `;
                            input.parentElement.appendChild(preview);
                        }
                        
                        preview.innerHTML = `
                            <img src="${e.target.result}" 
                                 style="max-width: 300px; max-height: 300px; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <p style="margin: 10px 0 0 0; font-size: 13px; color: #718096;">
                                ${file.name} (${(file.size / 1024).toFixed(1)} KB)
                            </p>
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
        
        // ========== ÐŸÐ†Ð”Ð¢Ð’Ð•Ð Ð”Ð–Ð•ÐÐÐ¯ Ð’Ð˜Ð”ÐÐ›Ð•ÐÐÐ¯ ==========
        
        const deleteLinks = document.querySelectorAll('a[href*="delete"]');
        deleteLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                if (!confirm('Ð’Ð¸ Ð²Ð¿ÐµÐ²Ð½ÐµÐ½Ñ–, Ñ‰Ð¾ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ Ñ†ÐµÐ¹ ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚? Ð¦ÑŽ Ð´Ñ–ÑŽ Ð½ÐµÐ¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ ÑÐºÐ°ÑÑƒÐ²Ð°Ñ‚Ð¸.')) {
                    e.preventDefault();
                }
            });
        });
        
        // ========== ÐŸÐžÐšÐ ÐÐ©Ð•ÐÐÐ¯ Ð¢ÐÐ‘Ð›Ð˜Ð¦Ð¬ ==========
        
        const resultTable = document.querySelector('#result_list');
        if (resultTable) {
            // Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ hover ÐµÑ„ÐµÐºÑ‚ Ð´Ð»Ñ Ñ€ÑÐ´ÐºÑ–Ð²
            const rows = resultTable.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                // Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ data-Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ Ð´Ð»Ñ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ñ–Ð½Ð´ÐµÐºÑÑƒ
                row.dataset.index = index;
                
                // ÐšÐ»Ñ–Ðº Ð¿Ð¾ Ñ€ÑÐ´ÐºÑƒ (ÐºÑ€Ñ–Ð¼ Ñ‡ÐµÐºÐ±Ð¾ÐºÑÑ–Ð² Ñ‚Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½ÑŒ) Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ” Ñ€ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ð½Ð½Ñ
                row.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'A' && !e.target.closest('a')) {
                        const editLink = this.querySelector('th a, td a');
                        if (editLink) {
                            window.location.href = editLink.href;
                        }
                    }
                });
                
                // Hover ÐµÑ„ÐµÐºÑ‚
                row.addEventListener('mouseenter', function() {
                    this.style.cursor = 'pointer';
                });
            });
            
            // ÐŸÐ¾ÐºÑ€Ð°Ñ‰ÑƒÑ”Ð¼Ð¾ ÑÐ¾Ñ€Ñ‚ÑƒÐ²Ð°Ð½Ð½Ñ - Ð´Ð¾Ð´Ð°Ñ”Ð¼Ð¾ Ð²Ñ–Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹ feedback
            const headers = resultTable.querySelectorAll('thead th a');
            headers.forEach(header => {
                header.addEventListener('click', function() {
                    const loader = document.createElement('div');
                    loader.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0,0,0,0.8);
                        color: white;
                        padding: 20px 30px;
                        border-radius: 8px;
                        z-index: 99999;
                        font-size: 14px;
                    `;
                    loader.textContent = 'â³ Ð¡Ð¾Ñ€Ñ‚ÑƒÐ²Ð°Ð½Ð½Ñ...';
                    document.body.appendChild(loader);
                });
            });
        }
        
        // ========== Ð¤Ð†Ð›Ð¬Ð¢Ð Ð˜ - ÐŸÐžÐšÐ ÐÐ©Ð•ÐÐÐ¯ UX ==========
        
        const filterSidebar = document.querySelector('#changelist-filter');
        if (filterSidebar) {
            const filterLinks = filterSidebar.querySelectorAll('a');
            filterLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ Ð»Ð¾Ð°Ð´ÐµÑ€
                    const loader = document.createElement('div');
                    loader.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0,0,0,0.8);
                        color: white;
                        padding: 20px 30px;
                        border-radius: 8px;
                        z-index: 99999;
                        font-size: 14px;
                    `;
                    loader.textContent = 'ðŸ” Ð¤Ñ–Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ñ–Ñ...';
                    document.body.appendChild(loader);
                });
            });
        }
        
        // ========== ÐœÐÐ¡ÐžÐ’Ð† Ð”Ð†Ð‡ - ÐŸÐžÐšÐ ÐÐ©Ð•ÐÐÐ¯ ==========
        
        const actionSelect = document.querySelector('select[name="action"]');
        if (actionSelect) {
            actionSelect.addEventListener('change', function() {
                const selectedAction = this.options[this.selectedIndex].text;
                if (selectedAction && selectedAction !== '---------') {
                    const checkedCount = document.querySelectorAll('input[name="_selected_action"]:checked').length;
                    if (checkedCount === 0) {
                        BeautyShopAdmin.showMessage('ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ…Ð¾Ñ‡Ð° Ð± Ð¾Ð´Ð¸Ð½ ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚', 'error');
                        this.value = '';
                    }
                }
            });
        }
        
        // ========== CKEDITOR ÐŸÐžÐšÐ ÐÐ©Ð•ÐÐÐ¯ ==========
        
        if (typeof CKEDITOR !== 'undefined') {
            CKEDITOR.on('instanceReady', function(event) {
                const editor = event.editor;
                
                // Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ– ÑÑ‚Ð¸Ð»Ñ–
                if (document.querySelector('[href*="ckeditor-custom.css"]')) {
                    editor.addContentsCss('/static/css/ckeditor-custom.css');
                }
                
                // ÐÐ²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð² localStorage (draft)
                let autoSaveTimer;
                const formId = editor.element.$.form?.id || 'editor';
                const draftKey = `admin_draft_${formId}_${editor.name}`;
                
                // Ð’Ñ–Ð´Ð½Ð¾Ð²Ð»ÑŽÑ”Ð¼Ð¾ draft Ð¿Ñ€Ð¸ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ–
                const savedDraft = localStorage.getItem(draftKey);
                if (savedDraft && !editor.getData()) {
                    if (confirm('Ð—Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¸Ð¹ Ñ‡ÐµÑ€Ð½ÐµÑ‚ÐºÐ°. Ð’Ñ–Ð´Ð½Ð¾Ð²Ð¸Ñ‚Ð¸?')) {
                        editor.setData(savedDraft);
                    } else {
                        localStorage.removeItem(draftKey);
                    }
                }
                
                // ÐÐ²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ ÐºÐ¾Ð¶Ð½Ñ– 30 ÑÐµÐºÑƒÐ½Ð´
                editor.on('change', function() {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(function() {
                        localStorage.setItem(draftKey, editor.getData());
                        console.log('Draft auto-saved');
                    }, 30000);
                });
                
                // ÐžÑ‡Ð¸Ñ‰ÑƒÑ”Ð¼Ð¾ draft Ð¿Ñ–ÑÐ»Ñ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾Ð³Ð¾ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ
                const form = editor.element.$.form;
                if (form) {
                    form.addEventListener('submit', function() {
                        localStorage.removeItem(draftKey);
                    });
                }
            });
        }
        
        // ========== ÐŸÐÐ“Ð†ÐÐÐ¦Ð†Ð¯ - ÐŸÐžÐšÐ ÐÐ©Ð•ÐÐÐ¯ ==========
        
        const paginationLinks = document.querySelectorAll('.paginator a');
        paginationLinks.forEach(link => {
            link.addEventListener('click', function() {
                // Scroll to top Ð¿Ñ€Ð¸ Ð·Ð¼Ñ–Ð½Ñ– ÑÑ‚Ð¾Ñ€Ñ–Ð½ÐºÐ¸
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        
        // ========== Ð¨Ð’Ð˜Ð”ÐšÐ† ÐšÐ›ÐÐ’Ð†Ð¨Ð† ==========
        
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S = Ð·Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ñ„Ð¾Ñ€Ð¼Ñƒ
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                const submitBtn = document.querySelector('input[type="submit"][name="_save"]');
                if (submitBtn) {
                    submitBtn.click();
                    BeautyShopAdmin.showMessage('Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ...');
                }
            }
            
            // Ctrl/Cmd + Shift + S = Ð·Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ñ– Ð¿Ñ€Ð¾Ð´Ð¾Ð²Ð¶Ð¸Ñ‚Ð¸ Ñ€ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ð½Ð½Ñ
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 's') {
                e.preventDefault();
                const submitBtn = document.querySelector('input[type="submit"][name="_continue"]');
                if (submitBtn) {
                    submitBtn.click();
                    BeautyShopAdmin.showMessage('Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ñ‚Ð° Ð¿Ñ€Ð¾Ð´Ð¾Ð²Ð¶ÐµÐ½Ð½Ñ...');
                }
            }
        });
        
        // ========== Ð¦Ð†ÐÐ˜ - Ð’ÐÐ›Ð†Ð”ÐÐ¦Ð†Ð¯ ==========
        
        const priceFields = document.querySelectorAll('input[type="number"][id*="price"]');
        priceFields.forEach(field => {
            field.addEventListener('blur', function() {
                if (this.value && parseFloat(this.value) < 0) {
                    this.style.borderColor = '#f56565';
                    BeautyShopAdmin.showMessage('Ð¦Ñ–Ð½Ð° Ð½Ðµ Ð¼Ð¾Ð¶Ðµ Ð±ÑƒÑ‚Ð¸ Ð²Ñ–Ð´\'Ñ”Ð¼Ð½Ð¾ÑŽ', 'error');
                    this.value = '';
                } else {
                    this.style.borderColor = '';
                }
            });
        });
        
        // ========== ÐÐšÐ¦Ð†Ð™ÐÐ† Ð¦Ð†ÐÐ˜ - ÐÐ’Ð¢ÐžÐŸÐ•Ð Ð•Ð’Ð†Ð ÐšÐ ==========
        
        const retailPriceField = document.querySelector('#id_retail_price');
        const salePriceField = document.querySelector('#id_sale_price');
        
        if (retailPriceField && salePriceField) {
            salePriceField.addEventListener('blur', function() {
                const retail = parseFloat(retailPriceField.value);
                const sale = parseFloat(this.value);
                
                if (retail && sale && sale >= retail) {
                    this.style.borderColor = '#f56565';
                    BeautyShopAdmin.showMessage('ÐÐºÑ†Ñ–Ð¹Ð½Ð° Ñ†Ñ–Ð½Ð° Ð¿Ð¾Ð²Ð¸Ð½Ð½Ð° Ð±ÑƒÑ‚Ð¸ Ð¼ÐµÐ½ÑˆÐ¾ÑŽ Ð·Ð° Ñ€Ð¾Ð·Ð´Ñ€Ñ–Ð±Ð½Ñƒ', 'error');
                } else if (retail && sale) {
                    this.style.borderColor = '#48bb78';
                    const discount = Math.round(((retail - sale) / retail) * 100);
                    BeautyShopAdmin.showMessage(`Ð—Ð½Ð¸Ð¶ÐºÐ°: ${discount}%`, 'success');
                }
            });
        }
        
        // ========== Ð¢ÐÐ™ÐœÐ•Ð Ð˜ Ð”Ð›Ð¯ ÐÐšÐ¦Ð†Ð™ ==========
        
        // Ð—Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð²ÑÑ– ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¸ Ð· Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ”ÑŽ Ð¿Ñ€Ð¾ Ð·Ð°ÐºÑ–Ð½Ñ‡ÐµÐ½Ð½Ñ Ð°ÐºÑ†Ñ–Ñ—
        const updateTimers = () => {
            const timerElements = document.querySelectorAll('[data-sale-end]');
            timerElements.forEach(el => {
                const endDate = new Date(el.dataset.saleEnd);
                const now = new Date();
                const diff = endDate - now;
                
                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    if (days <= 3) {
                        el.style.color = '#f56565';
                        el.style.fontWeight = '700';
                    }
                }
            });
        };
        
        updateTimers();
        setInterval(updateTimers, 60000); // ÐžÐ½Ð¾Ð²Ð»ÑŽÑ”Ð¼Ð¾ ÐºÐ¾Ð¶Ð½Ñƒ Ñ…Ð²Ð¸Ð»Ð¸Ð½Ñƒ
        
        // ========== Ð—ÐÐšÐ Ð˜Ð¢Ð¢Ð¯ ÐŸÐžÐ’Ð†Ð”ÐžÐœÐ›Ð•ÐÐ¬ ==========
        
        const messageList = document.querySelector('.messagelist');
        if (messageList) {
            const messages = messageList.querySelectorAll('li');
            messages.forEach(message => {
                message.addEventListener('click', function() {
                    this.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        this.remove();
                        if (messageList.children.length === 0) {
                            messageList.remove();
                        }
                    }, 300);
                });
                
                setTimeout(() => {
                    message.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        message.remove();
                        if (messageList.children.length === 0) {
                            messageList.remove();
                        }
                    }, 300);
                }, 5000);
            });
        }
        
        console.log('âœ… Beauty Shop Admin JS initialized');
    });
    
    // ============================================
    // ANIMATIONS
    // ============================================
    
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
    
})();
